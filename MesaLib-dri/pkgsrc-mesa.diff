Index: graphics/Mesa/Makefile.common
===================================================================
RCS file: /cvsroot/pkgsrc/graphics/Mesa/Makefile.common,v
retrieving revision 1.55
diff -u -d -r1.55 Makefile.common
--- graphics/Mesa/Makefile.common	22 Feb 2007 19:26:32 -0000	1.55
+++ graphics/Mesa/Makefile.common	5 Aug 2007 04:55:48 -0000
@@ -16,7 +16,7 @@
 #	graphics/MesaDemos
 #	graphics/glx-utils
 #
-MESA_VERSION=	6.4.2
+MESA_VERSION=	7.0.1
 
 MAINTAINER=	pkgsrc-users@NetBSD.org
 HOMEPAGE=	http://www.mesa3d.org/
Index: graphics/MesaLib/Makefile
===================================================================
RCS file: /cvsroot/pkgsrc/graphics/MesaLib/Makefile,v
retrieving revision 1.52
diff -u -d -r1.52 Makefile
--- graphics/MesaLib/Makefile	24 Jan 2007 19:55:01 -0000	1.52
+++ graphics/MesaLib/Makefile	5 Aug 2007 04:55:48 -0000
@@ -1,7 +1,6 @@
 # $NetBSD: pkgsrc-mesa.diff,v 1.2 2007/08/05 04:56:17 bsadewitz Exp $
 
 PKGNAME=	MesaLib-${MESA_VERSION}
-PKGREVISION=	3
 COMMENT=	Graphics library similar to SGI's OpenGL
 
 .include "../../graphics/Mesa/Makefile.lib"
Index: graphics/MesaLib/buildlink3.mk
===================================================================
RCS file: /cvsroot/pkgsrc/graphics/MesaLib/buildlink3.mk,v
retrieving revision 1.38
diff -u -d -r1.38 buildlink3.mk
--- graphics/MesaLib/buildlink3.mk	2 Feb 2007 17:41:36 -0000	1.38
+++ graphics/MesaLib/buildlink3.mk	5 Aug 2007 04:55:48 -0000
@@ -1,9 +1,9 @@
-# $NetBSD: pkgsrc-mesa.diff,v 1.2 2007/08/05 04:56:17 bsadewitz Exp $
+# $NetBSD: pkgsrc-mesa.diff,v 1.2 2007/08/05 04:56:17 bsadewitz Exp $
 
 BUILDLINK_DEPTH:=	${BUILDLINK_DEPTH}+
 MESALIB_BUILDLINK3_MK:=	${MESALIB_BUILDLINK3_MK}+
 
-.if !empty(BUILDLINK_DEPTH:M+)
+.if ${BUILDLINK_DEPTH} == "+"
 BUILDLINK_DEPENDS+=	MesaLib
 .endif
 
@@ -11,25 +11,19 @@
 BUILDLINK_PACKAGES+=	MesaLib
 BUILDLINK_ORDER:=	${BUILDLINK_ORDER} ${BUILDLINK_DEPTH}MesaLib
 
-.if !empty(MESALIB_BUILDLINK3_MK:M+)
-BUILDLINK_API_DEPENDS.MesaLib+=	MesaLib>=3.4.2
-BUILDLINK_ABI_DEPENDS.MesaLib+=	MesaLib>=6.4.1nb1
+.if ${MESALIB_BUILDLINK3_MK} == "+"
+BUILDLINK_API_DEPENDS.MesaLib+=	MesaLib>=7.0.1
+BUILDLINK_API_DEPENDS.MesaLib+= MesaLib>=6.4.1
+BUILDLINK_API_DEPENDS.MesaLib+= MesaLib>=3.4.2
 BUILDLINK_PKGSRCDIR.MesaLib?=	../../graphics/MesaLib
-
-.if !defined(BUILDING_MESA)
-BUILDLINK_CPPFLAGS.MesaLib=	-DGLX_GLXEXT_LEGACY
-.endif
-
 BUILDLINK_TRANSFORM+=		l:MesaGL:GL
-
+BUILDLINK_TRANSFORM+=		l:GL:GL:Xxf86vm:Xfixes:Xdamage:drm
 .endif	# MESALIB_BUILDLINK3_MK
 
-.include "../../mk/bsd.fast.prefs.mk"
-
-.if !empty(MACHINE_PLATFORM:MNetBSD-[12].*)
-.include "../../devel/pthread-stublib/buildlink3.mk"
-.endif
-
+.include "../../x11/libdrm/buildlink3.mk"
 .include "../../x11/libXext/buildlink3.mk"
+.include "../../x11/libXxf86vm/buildlink3.mk"
+.include "../../x11/libXdamage/buildlink3.mk"
+.include "../../x11/libXfixes/buildlink3.mk"
 
 BUILDLINK_DEPTH:=	${BUILDLINK_DEPTH:S/+$//}
Index: graphics/MesaLib/distinfo
===================================================================
RCS file: /cvsroot/pkgsrc/graphics/MesaLib/distinfo,v
retrieving revision 1.45
diff -u -d -r1.45 distinfo
--- graphics/MesaLib/distinfo	13 Apr 2007 09:12:02 -0000	1.45
+++ graphics/MesaLib/distinfo	5 Aug 2007 04:55:48 -0000
@@ -1,24 +1,24 @@
 $NetBSD: pkgsrc-mesa.diff,v 1.2 2007/08/05 04:56:17 bsadewitz Exp $
 
-SHA1 (Mesa-6.4.2/MesaDemos-6.4.2.tar.bz2) = 35b1ff78fc1bd1c303be754ad2ff4252ad6c0258
-RMD160 (Mesa-6.4.2/MesaDemos-6.4.2.tar.bz2) = 82e1dafd39abbe1c0e1de49adcff00dec19c6c1a
-Size (Mesa-6.4.2/MesaDemos-6.4.2.tar.bz2) = 814178 bytes
-SHA1 (Mesa-6.4.2/MesaGLUT-6.4.2.tar.bz2) = f136387c3076cfb24a40a7e41cacc43359493771
-RMD160 (Mesa-6.4.2/MesaGLUT-6.4.2.tar.bz2) = 46ab4c40107ba2765bc944b026ed9f584f8c432e
-Size (Mesa-6.4.2/MesaGLUT-6.4.2.tar.bz2) = 270291 bytes
-SHA1 (Mesa-6.4.2/MesaLib-6.4.2.tar.bz2) = 4f042bdf38c9eb62e04660bd18566e7ca50d8640
-RMD160 (Mesa-6.4.2/MesaLib-6.4.2.tar.bz2) = 6bf1afc0d3bd3f5e3b5c1a019838f40603446509
-Size (Mesa-6.4.2/MesaLib-6.4.2.tar.bz2) = 2913009 bytes
+SHA1 (Mesa-7.0.1/MesaDemos-7.0.1.tar.bz2) = 4d6cb158b58dbda9411d00e99a01031e13cae2ec
+RMD160 (Mesa-7.0.1/MesaDemos-7.0.1.tar.bz2) = 58537c690d811da09f788bf9b5b5bd999e5445c6
+Size (Mesa-7.0.1/MesaDemos-7.0.1.tar.bz2) = 1340949 bytes
+SHA1 (Mesa-7.0.1/MesaGLUT-7.0.1.tar.bz2) = ee63b2b1804106a05efaffd3da2dee7637d0eecb
+RMD160 (Mesa-7.0.1/MesaGLUT-7.0.1.tar.bz2) = 1c84391874e013145529fee43763ff9f57a88dc9
+Size (Mesa-7.0.1/MesaGLUT-7.0.1.tar.bz2) = 315599 bytes
+SHA1 (Mesa-7.0.1/MesaLib-7.0.1.tar.bz2) = deb1002cf377ba8bd9407bd3cf573f8c8be31671
+RMD160 (Mesa-7.0.1/MesaLib-7.0.1.tar.bz2) = b44fd8ebffd17aa72c3b6cca1c2924e66787aa78
+Size (Mesa-7.0.1/MesaLib-7.0.1.tar.bz2) = 3343538 bytes
 SHA1 (patch-aa) = 90457ea124a42150e3a37b48e1e0691597668606
 SHA1 (patch-ab) = c257a57d4570576f160e9a4c029384718402c1bd
-SHA1 (patch-ac) = a12c3538907aaa63184371037c0f70924861fbe4
-SHA1 (patch-ad) = e926180243a180bc80b0332f2bcacc14b7c1f13b
-SHA1 (patch-ae) = c7dd8f4b9db5241acdd0f850162b8b4116cd93bd
-SHA1 (patch-af) = e3daa689966c27c32ddb0060a0910d2e5d063555
-SHA1 (patch-ag) = 722234c02093e0d3b10659fa83bb14c7f2e7a8ac
-SHA1 (patch-ah) = 94faa48a6945aa6e7a0fc8806129a463d99d4338
+SHA1 (patch-ac) = 31199a11541b3bc7acc478c8349e029f344e88b4
+SHA1 (patch-ad) = da39a3ee5e6b4b0d3255bfef95601890afd80709
+SHA1 (patch-ae) = ed5781ec709749f757d46a7ea67bf8e7d5286291
+SHA1 (patch-af) = 8c041b4ec4b5411d2562de0cde417d72d835eaa2
+SHA1 (patch-ag) = aa355b10126ad3b707d0bdcf8783019a48e55ff6
+SHA1 (patch-ah) = fb37ee6e85360c5c2f76cdf2ee3b84f8ee4a9bd9
 SHA1 (patch-ai) = 3c5e4cc1e054514111d50c1d01257f4647b14558
-SHA1 (patch-aj) = a805947e1aaf73a798fd3a8c6e39bf1bd62afc3a
+SHA1 (patch-aj) = da39a3ee5e6b4b0d3255bfef95601890afd80709
 SHA1 (patch-ak) = 9f3480d08d2b6b7048b018956c57ad6e5d253174
-SHA1 (patch-al) = 8ccbc370bc52882ee72ba76b72a99f163f7b89a7
-SHA1 (patch-am) = a7a40d0d1f371cfa312ae504582ce0521172f85c
+SHA1 (patch-al) = da39a3ee5e6b4b0d3255bfef95601890afd80709
+SHA1 (patch-am) = 393a64722f27d90ba3f0d7dd58dd789e386a0a80
Index: graphics/MesaLib/patches/patch-ac
===================================================================
RCS file: /cvsroot/pkgsrc/graphics/MesaLib/patches/patch-ac,v
retrieving revision 1.9
diff -u -d -r1.9 patch-ac
--- graphics/MesaLib/patches/patch-ac	19 Jan 2006 12:53:17 -0000	1.9
+++ graphics/MesaLib/patches/patch-ac	5 Aug 2007 04:55:48 -0000
@@ -1,7 +1,7 @@
-$NetBSD: pkgsrc-mesa.diff,v 1.2 2007/08/05 04:56:17 bsadewitz Exp $
+$NetBSD: pkgsrc-mesa.diff,v 1.2 2007/08/05 04:56:17 bsadewitz Exp $
 
---- Makefile.orig	2005-11-29 23:38:49.000000000 +0100
-+++ Makefile
+--- Makefile.orig	2006-12-02 12:20:04.000000000 -0600
++++ Makefile	2007-01-15 12:42:19.000000000 -0600
 @@ -2,7 +2,7 @@
  
  TOP = .
@@ -11,19 +11,19 @@
  
  
  default: $(TOP)/configs/current
-@@ -74,6 +74,7 @@ hpux11-64 \
- hpux11-64-static \
+@@ -80,6 +80,7 @@
+ hpux11-ia64-static \
  hpux9 \
  hpux9-gcc \
 +interix3 \
  irix6-64 \
  irix6-64-static \
  irix6-n32 \
-@@ -117,6 +118,7 @@ linux-x86-xcb \
- linux-x86-glide \
- linux-x86-static \
- netbsd \
-+pkgsrc \
+@@ -129,6 +130,7 @@
  openbsd \
  osf1 \
+ osf1-static \
++pkgsrc \
  solaris-x86 \
+ solaris-x86-gcc \
+ solaris-x86-gcc-static \
Index: graphics/MesaLib/patches/patch-ad
===================================================================
RCS file: /cvsroot/pkgsrc/graphics/MesaLib/patches/patch-ad,v
retrieving revision 1.8
diff -u -d -r1.8 patch-ad
--- graphics/MesaLib/patches/patch-ad	19 Jan 2006 12:53:17 -0000	1.8
+++ graphics/MesaLib/patches/patch-ad	5 Aug 2007 04:55:48 -0000
@@ -1,59 +0,0 @@
-$NetBSD: pkgsrc-mesa.diff,v 1.2 2007/08/05 04:56:17 bsadewitz Exp $
-
---- src/mesa/Makefile.orig	2005-07-26 07:55:56.000000000 +0200
-+++ src/mesa/Makefile
-@@ -14,13 +14,13 @@ GL_TINY = 0$(MESA_MAJOR)0$(MESA_MINOR)0$
- .SUFFIXES : .cpp
- 
- .c.o:
--	$(CC) -c $(INCLUDE_DIRS) $(CFLAGS) $< -o $@
-+	${LIBTOOL} --mode=compile $(CC) -c $(INCLUDE_DIRS) $(CFLAGS) $< -o $@
- 
- .cpp.o:
--	$(CXX) -c $(INCLUDE_DIRS) $(CXXFLAGS) $< -o $@
-+	${LIBTOOL} --mode=compile $(CXX) -c $(INCLUDE_DIRS) $(CXXFLAGS) $< -o $@
- 
- .S.o:
--	$(CC) -c $(INCLUDE_DIRS) $(CFLAGS) $< -o $@
-+	${LIBTOOL} --mode=compile $(CC) -c $(INCLUDE_DIRS) $(CFLAGS) $< -o $@
- 
- 
- # Figure out what to make here
-@@ -150,25 +150,23 @@ subdirs:
- 
- # Make the GL library
- $(LIB_DIR)/$(GL_LIB_NAME): $(STAND_ALONE_OBJECTS)
--	@ $(TOP)/bin/mklib -o $(GL_LIB) -linker '$(CC)' \
--		-major $(GL_MAJOR) -minor $(GL_MINOR) -patch $(GL_TINY) \
--		-install $(LIB_DIR) \
--		$(MKLIB_OPTIONS) $(GL_LIB_DEPS) $(STAND_ALONE_OBJECTS)
-+	${LIBTOOL} --mode=link ${CC} -o ${GL_LIB_NAME:.so=.la} \
-+		${STAND_ALONE_OBJECTS:.o=.lo} \
-+		-rpath ${PREFIX}/lib -version-info ${GL_MAJOR}:${GL_MINOR} \
-+		-L${X11BASE}/lib -Wl,-R${X11BASE}/lib ${GL_LIB_DEPS}
- 
- # Make the OSMesa library
- $(LIB_DIR)/$(OSMESA_LIB_NAME): $(OSMESA_DRIVER_OBJECTS) $(OSMESA16_OBJECTS)
- 	@ if [ "${DRIVER_DIRS}" = "osmesa" ] ; then \
--		$(TOP)/bin/mklib -o $(OSMESA_LIB) -linker '$(CC)' \
--			-major $(MESA_MAJOR) \
--			-minor $(MESA_MINOR) -patch $(MESA_TINY) \
--			-install $(LIB_DIR) $(MKLIB_OPTIONS) \
--			$(OSMESA_LIB_DEPS) $(OSMESA16_OBJECTS) ; \
-+		${LIBTOOL} --mode=link ${CC} -o ${OSMESA_LIB_NAME:.so=.la} \
-+			${OSMESA16_OBJECTS:.o=.lo} -rpath ${PREFIX}/lib \
-+			-version-info ${MESA_MAJOR}:${MESA_MINOR} \
-+			${OSMESA_LIB_DEPS:S|-lGL|libGL.la|} ; \
- 	else \
--		$(TOP)/bin/mklib -o $(OSMESA_LIB) -linker '$(CC)' \
--			-major $(MESA_MAJOR) \
--			-minor $(MESA_MINOR) -patch $(GL_TINY) \
--			-install $(LIB_DIR) $(MKLIB_OPTIONS) \
--			$(OSMESA_LIB_DEPS) $(OSMESA_DRIVER_OBJECTS) ; \
-+		${LIBTOOL} --mode=link ${CC} -o ${OSMESA_LIB_NAME:.so=.la} \
-+			${OSMESA_DRIVER_OBJECTS:.o=.lo} -rpath ${PREFIX}/lib \
-+			-version-info ${MESA_MAJOR}:${MESA_MINOR} \
-+			${OSMESA_LIB_DEPS:S|-lGL|libGL.la|} ; \
- 	fi
- 
- 
Index: graphics/MesaLib/patches/patch-ae
===================================================================
RCS file: /cvsroot/pkgsrc/graphics/MesaLib/patches/patch-ae,v
retrieving revision 1.7
diff -u -d -r1.7 patch-ae
--- graphics/MesaLib/patches/patch-ae	19 Jan 2006 12:53:17 -0000	1.7
+++ graphics/MesaLib/patches/patch-ae	5 Aug 2007 04:55:48 -0000
@@ -1,8 +1,8 @@
-$NetBSD: pkgsrc-mesa.diff,v 1.2 2007/08/05 04:56:17 bsadewitz Exp $
+$NetBSD: pkgsrc-mesa.diff,v 1.2 2007/08/05 04:56:17 bsadewitz Exp $
 
---- src/glw/Makefile.orig	2005-07-26 07:55:56.000000000 +0200
-+++ src/glw/Makefile
-@@ -17,7 +17,7 @@ OBJECTS = $(GLW_SOURCES:.c=.o)
+--- src/glw/Makefile.orig	2006-10-19 14:58:24.000000000 -0500
++++ src/glw/Makefile	2007-01-18 15:29:28.000000000 -0600
+@@ -17,7 +17,7 @@
  ##### RULES #####
  
  .c.o:
@@ -11,13 +11,13 @@
  
  
  
-@@ -33,10 +33,10 @@ clean:
+@@ -38,10 +38,10 @@
  
  # Make the library
- $(LIB_DIR)/$(GLW_LIB_NAME): $(OBJECTS)
+ $(TOP)/$(LIB_DIR)/$(GLW_LIB_NAME): $(OBJECTS)
 -	$(TOP)/bin/mklib -o $(GLW_LIB) -linker '$(CC)' \
 -		-major $(MAJOR) -minor $(MINOR) -patch $(TINY) \
--		$(MKLIB_OPTIONS) -install $(LIB_DIR) \
+-		$(MKLIB_OPTIONS) -install $(TOP)/$(LIB_DIR) \
 -		$(GLW_LIB_DEPS) $(OBJECTS)
 +	${LIBTOOL} --mode=link ${CC} -o ${GLW_LIB_NAME:.so=.la} \
 +		${OBJECTS:.o=.lo} -rpath ${PREFIX}/lib \
Index: graphics/MesaLib/patches/patch-af
===================================================================
RCS file: /cvsroot/pkgsrc/graphics/MesaLib/patches/patch-af,v
retrieving revision 1.6
diff -u -d -r1.6 patch-af
--- graphics/MesaLib/patches/patch-af	1 Jun 2006 12:56:41 -0000	1.6
+++ graphics/MesaLib/patches/patch-af	5 Aug 2007 04:55:48 -0000
@@ -1,8 +1,8 @@
-$NetBSD: pkgsrc-mesa.diff,v 1.2 2007/08/05 04:56:17 bsadewitz Exp $
+$NetBSD: pkgsrc-mesa.diff,v 1.2 2007/08/05 04:56:17 bsadewitz Exp $
 
---- src/glu/sgi/Makefile.orig	2005-07-26 07:55:56.000000000 +0200
-+++ src/glu/sgi/Makefile
-@@ -115,9 +115,11 @@ OBJECTS = $(C_OBJECTS) $(CC_OBJECTS)
+--- src/glu/sgi/Makefile.orig	2006-07-12 21:43:20.000000000 -0500
++++ src/glu/sgi/Makefile	2007-01-18 15:35:03.000000000 -0600
+@@ -115,9 +115,11 @@
  ##### RULES #####
  
  .c.o:
@@ -14,13 +14,13 @@
  	$(CXX) -c $(INCDIRS) $(CXXFLAGS) -DNDEBUG -DLIBRARYBUILD $< -o $@
  
  
-@@ -136,10 +138,9 @@ $(LIB_DIR):
+@@ -136,10 +138,9 @@
  
  # Make the library:
- $(LIB_DIR)/$(GLU_LIB_NAME): $(OBJECTS)
+ $(TOP)/$(LIB_DIR)/$(GLU_LIB_NAME): $(OBJECTS)
 -	$(TOP)/bin/mklib -o $(GLU_LIB) -linker '$(CXX)' \
 -		-major $(GLU_MAJOR) -minor $(GLU_MINOR) -patch $(GLU_TINY) \
--		-cplusplus $(MKLIB_OPTIONS) -install $(LIB_DIR) \
+-		-cplusplus $(MKLIB_OPTIONS) -install $(TOP)/$(LIB_DIR) \
 -		$(GLU_LIB_DEPS) $(OBJECTS)
 +	${LIBTOOL} --tag=CXX --mode=link ${CXX} -o ${GLU_LIB_NAME:.so=.la} \
 +		${OBJECTS:.o=.lo} -rpath ${PREFIX}/lib \
Index: graphics/MesaLib/patches/patch-ag
===================================================================
RCS file: /cvsroot/pkgsrc/graphics/MesaLib/patches/patch-ag,v
retrieving revision 1.8
diff -u -d -r1.8 patch-ag
--- graphics/MesaLib/patches/patch-ag	19 Jan 2006 12:53:17 -0000	1.8
+++ graphics/MesaLib/patches/patch-ag	5 Aug 2007 04:55:48 -0000
@@ -1,22 +1,22 @@
-$NetBSD: pkgsrc-mesa.diff,v 1.2 2007/08/05 04:56:17 bsadewitz Exp $
+$NetBSD: pkgsrc-mesa.diff,v 1.2 2007/08/05 04:56:17 bsadewitz Exp $
 
---- src/glut/glx/Makefile.orig	2005-07-26 07:55:56.000000000 +0200
-+++ src/glut/glx/Makefile
-@@ -79,6 +79,7 @@ OBJECTS = $(SOURCES:.c=.o)
+--- src/glut/glx/Makefile.orig	2006-10-19 14:57:52.000000000 -0500
++++ src/glut/glx/Makefile	2007-01-18 15:36:47.000000000 -0600
+@@ -79,6 +79,7 @@
  ##### RULES #####
  
  .c.o:
 +	${LIBTOOL} --mode=compile \
- 	$(CC) -c -I$(TOP)/include $(CFLAGS) $(GLUT_CFLAGS) $<
+ 	$(CC) -c -I$(TOP)/include $(X11_INCLUDES) $(CFLAGS) $(GLUT_CFLAGS) $<
  
  
-@@ -90,10 +91,10 @@ default: $(LIB_DIR)/$(GLUT_LIB_NAME)
+@@ -90,10 +91,10 @@
  
  # Make the library
- $(LIB_DIR)/$(GLUT_LIB_NAME): depend $(OBJECTS)
+ $(TOP)/$(LIB_DIR)/$(GLUT_LIB_NAME): depend $(OBJECTS)
 -	$(TOP)/bin/mklib -o $(GLUT_LIB) -linker '$(CC)' \
 -		-major $(GLUT_MAJOR) -minor $(GLUT_MINOR) -patch $(GLUT_TINY) \
--		$(MKLIB_OPTIONS) -install $(LIB_DIR) \
+-		$(MKLIB_OPTIONS) -install $(TOP)/$(LIB_DIR) \
 -		$(GLUT_LIB_DEPS) $(OBJECTS)
 +	${LIBTOOL} --mode=link ${CC} -o ${GLUT_LIB_NAME:.so=.la} \
 +		${OBJECTS:.o=.lo} -rpath ${PREFIX}/lib \
@@ -24,4 +24,4 @@
 +		-L${X11BASE}/lib -Wl,-R${X11BASE}/lib ${GLUT_LIB_DEPS}
  
  
- clean:
+ install:
Index: graphics/MesaLib/patches/patch-ah
===================================================================
RCS file: /cvsroot/pkgsrc/graphics/MesaLib/patches/patch-ah,v
retrieving revision 1.5
diff -u -d -r1.5 patch-ah
--- graphics/MesaLib/patches/patch-ah	21 Mar 2006 19:26:32 -0000	1.5
+++ graphics/MesaLib/patches/patch-ah	5 Aug 2007 04:55:48 -0000
@@ -1,8 +1,8 @@
-$NetBSD: pkgsrc-mesa.diff,v 1.2 2007/08/05 04:56:17 bsadewitz Exp $
+$NetBSD: pkgsrc-mesa.diff,v 1.2 2007/08/05 04:56:17 bsadewitz Exp $
 
---- configs/default.orig	2005-10-25 01:35:14.000000000 +0200
-+++ configs/default
-@@ -14,10 +14,6 @@ MESA_TINY=1
+--- configs/default.orig	2006-10-22 12:20:22.000000000 -0500
++++ configs/default	2007-01-18 15:38:16.000000000 -0600
+@@ -16,10 +16,6 @@
  DRM_SOURCE_PATH=$(TOP)/../drm
  
  # Compiler and flags
@@ -13,21 +13,12 @@
  GLU_CFLAGS = 
  
  # Misc tools and flags
-@@ -56,7 +52,7 @@ GLW_SOURCES = GLwDrawA.c
- 
- # Directories
- LIB_DIR = $(TOP)/lib
--INSTALL_PREFIX = /usr/local
-+INSTALL_PREFIX = ${PREFIX}
- SRC_DIRS = mesa glu glut/glx glw
- GLU_DIRS = sgi
- DRIVER_DIRS = x11 osmesa
-@@ -66,7 +62,7 @@ PROGRAM_DIRS = demos redbook samples xde
+@@ -68,7 +64,7 @@
  
  # Library/program dependencies
- EXTRA_LIB_PATH ?=
+ #EXTRA_LIB_PATH ?=
 -GL_LIB_DEPS = $(EXTRA_LIB_PATH) -lX11 -lXext -lm -lpthread
 +GL_LIB_DEPS = $(EXTRA_LIB_PATH) -lX11 -lXext -lm ${PTHREAD_STUBLIB}
- OSMESA_LIB_DEPS = -L$(LIB_DIR) -l$(GL_LIB)
- GLU_LIB_DEPS = -L$(LIB_DIR) -l$(GL_LIB) -lm
- GLUT_LIB_DEPS = -L$(LIB_DIR) -l$(GLU_LIB) -l$(GL_LIB) $(EXTRA_LIB_PATH) -lX11 -lXmu -lXt -lXi -lm
+ OSMESA_LIB_DEPS = -L$(TOP)/$(LIB_DIR) -l$(GL_LIB)
+ GLU_LIB_DEPS = -L$(TOP)/$(LIB_DIR) -l$(GL_LIB) -lm
+ GLUT_LIB_DEPS = -L$(TOP)/$(LIB_DIR) -l$(GLU_LIB) -l$(GL_LIB) $(EXTRA_LIB_PATH) -lX11 -lXmu -lXt -lXi -lm
Index: graphics/MesaLib/patches/patch-aj
===================================================================
RCS file: /cvsroot/pkgsrc/graphics/MesaLib/patches/patch-aj,v
retrieving revision 1.2
diff -u -d -r1.2 patch-aj
--- graphics/MesaLib/patches/patch-aj	19 Jan 2006 12:53:17 -0000	1.2
+++ graphics/MesaLib/patches/patch-aj	5 Aug 2007 04:55:48 -0000
@@ -1,22 +0,0 @@
-$NetBSD: pkgsrc-mesa.diff,v 1.2 2007/08/05 04:56:17 bsadewitz Exp $
-
---- src/mesa/drivers/x11/xmesaP.h.orig	2005-10-04 23:00:36.000000000 +0200
-+++ src/mesa/drivers/x11/xmesaP.h
-@@ -30,7 +30,7 @@
- #ifdef XFree86Server
- # include "GL/xf86glx.h"
- # include "xf86glx_util.h"
--#elif defined(USE_XSHM)
-+#elif defined(USE_XSHM) || defined(USE_XSHM_HDRONLY)
- # include <X11/extensions/XShm.h>
- #endif
- #include "GL/xmesa.h"
-@@ -218,7 +218,7 @@ struct xmesa_buffer {
- 				/*    0 = not available			*/
- 				/*    1 = XImage support available	*/
- 				/*    2 = Pixmap support available too	*/
--#ifdef USE_XSHM
-+#if defined(USE_XSHM) || defined(USE_XSHM_HDRONLY)
-    XShmSegmentInfo shminfo;
- #endif
- #endif
Index: graphics/MesaLib/patches/patch-al
===================================================================
RCS file: /cvsroot/pkgsrc/graphics/MesaLib/patches/patch-al,v
retrieving revision 1.1
diff -u -d -r1.1 patch-al
--- graphics/MesaLib/patches/patch-al	31 Jan 2006 21:44:31 -0000	1.1
+++ graphics/MesaLib/patches/patch-al	5 Aug 2007 04:55:48 -0000
@@ -1,839 +0,0 @@
-$NetBSD: pkgsrc-mesa.diff,v 1.2 2007/08/05 04:56:17 bsadewitz Exp $
-
-Declarations inside of macros are evil. Even more if they are not preceded
-by an additional opening brace.
-
---- src/mesa/drivers/x11/xm_tri.c.orig	Tue Jan 31 22:16:56 2006
-+++ src/mesa/drivers/x11/xm_tri.c	Tue Jan 31 22:30:15 2006
-@@ -64,7 +64,7 @@
-    XMesaContext xmesa = XMESA_CONTEXT(ctx);			\
-    GET_XRB(xrb);
- 
--#define RENDER_SPAN( span )					\
-+#define RENDER_SPAN( span ) {					\
-    GLint x = span.x, y = YFLIP(xrb, span.y);			\
-    GLuint i;							\
-    for (i = 0; i < span.end; i++, x++) {			\
-@@ -80,7 +80,7 @@
-       span.green += span.greenStep;				\
-       span.blue += span.blueStep;				\
-       span.z += span.zStep;					\
--   }
-+   } }
- 
- #include "swrast/s_tritemp.h"
- 
-@@ -99,7 +99,7 @@
- #define BYTES_PER_ROW (xrb->ximage->bytes_per_line)
- #define SETUP_CODE						\
-    GET_XRB(xrb);
--#define RENDER_SPAN( span )					\
-+#define RENDER_SPAN( span ) {					\
-    GLuint i;							\
-    for (i = 0; i < span.end; i++) {				\
-       const DEPTH_TYPE z = FixedToDepth(span.z);		\
-@@ -112,7 +112,7 @@
-       span.green += span.greenStep;				\
-       span.blue += span.blueStep;				\
-       span.z += span.zStep;					\
--   }
-+   } }
- 
- #include "swrast/s_tritemp.h"
- 
-@@ -131,7 +131,7 @@
- #define SETUP_CODE						\
-    GET_XRB(xrb);
- 
--#define RENDER_SPAN( span )					\
-+#define RENDER_SPAN( span ) {					\
-    GLuint i;							\
-    for (i = 0; i < span.end; i++) {				\
-       const DEPTH_TYPE z = FixedToDepth(span.z);		\
-@@ -144,7 +144,7 @@
-       span.green += span.greenStep;				\
-       span.blue += span.blueStep;				\
-       span.z += span.zStep;					\
--   }
-+   } }
- 
- #include "swrast/s_tritemp.h"
- 
-@@ -163,7 +163,7 @@
- #define SETUP_CODE						\
-    GET_XRB(xrb);
- 
--#define RENDER_SPAN( span )					\
-+#define RENDER_SPAN( span ) {					\
-    GLuint i;							\
-    for (i = 0; i < span.end; i++) {				\
-       const DEPTH_TYPE z = FixedToDepth(span.z);		\
-@@ -176,7 +176,7 @@
-       span.green += span.greenStep;				\
-       span.blue += span.blueStep;				\
-       span.z += span.zStep;					\
--   }
-+   } }
- 
- #include "swrast/s_tritemp.h"
- 
-@@ -194,7 +194,7 @@
- #define BYTES_PER_ROW (xrb->ximage->bytes_per_line)
- #define SETUP_CODE						\
-    GET_XRB(xrb);
--#define RENDER_SPAN( span ) 					\
-+#define RENDER_SPAN( span )  {					\
-    GLuint i;							\
-    for (i = 0; i < span.end; i++) {				\
-       const DEPTH_TYPE z = FixedToDepth(span.z);		\
-@@ -209,7 +209,7 @@
-       span.green += span.greenStep;				\
-       span.blue += span.blueStep;				\
-       span.z += span.zStep;					\
--   }
-+   } }
- #include "swrast/s_tritemp.h"
- 
- 
-@@ -224,7 +224,7 @@
- #define SETUP_CODE						\
-    XMesaContext xmesa = XMESA_CONTEXT(ctx);			\
-    GET_XRB(xrb);
--#define RENDER_SPAN( span )					\
-+#define RENDER_SPAN( span ) {					\
-    GLuint i;							\
-    GLint x = span.x, y = YFLIP(xrb, span.y);			\
-    for (i = 0; i < span.end; i++, x++) {			\
-@@ -240,7 +240,7 @@
-       span.green += span.greenStep;				\
-       span.blue += span.blueStep;				\
-       span.z += span.zStep;					\
--   }
-+   } }
- #include "swrast/s_tritemp.h"
- 
- 
-@@ -257,7 +257,7 @@
- #define BYTES_PER_ROW (xrb->ximage->bytes_per_line)
- #define SETUP_CODE						\
-    GET_XRB(xrb);
--#define RENDER_SPAN( span )					\
-+#define RENDER_SPAN( span ) {					\
-    GLuint i;							\
-    for (i = 0; i < span.end; i++) {				\
-       const DEPTH_TYPE z = FixedToDepth(span.z);		\
-@@ -270,7 +270,7 @@
-       span.green += span.greenStep;				\
-       span.blue += span.blueStep;				\
-       span.z += span.zStep;					\
--   }
-+   } }
- #include "swrast/s_tritemp.h"
- 
- 
-@@ -288,7 +288,7 @@
- #define SETUP_CODE						\
-    XMesaContext xmesa = XMESA_CONTEXT(ctx);			\
-    GET_XRB(xrb);
--#define RENDER_SPAN( span )					\
-+#define RENDER_SPAN( span ) {					\
-    GLuint i;							\
-    GLint x = span.x, y = YFLIP(xrb, span.y);			\
-    for (i = 0; i < span.end; i++, x++) {			\
-@@ -302,7 +302,7 @@
-       span.green += span.greenStep;				\
-       span.blue += span.blueStep;				\
-       span.z += span.zStep;					\
--   }
-+   } }
- #include "swrast/s_tritemp.h"
- 
- 
-@@ -319,7 +319,7 @@
- #define BYTES_PER_ROW (xrb->ximage->bytes_per_line)
- #define SETUP_CODE						\
-    GET_XRB(xrb);
--#define RENDER_SPAN( span )					\
-+#define RENDER_SPAN( span ) {					\
-    GLuint i;							\
-    GLint x = span.x, y = YFLIP(xrb, span.y);			\
-    XDITHER_SETUP(y);						\
-@@ -334,7 +334,7 @@
-       span.green += span.greenStep;				\
-       span.blue += span.blueStep;				\
-       span.z += span.zStep;					\
--   }
-+   } }
- #include "swrast/s_tritemp.h"
- 
- 
-@@ -349,7 +349,7 @@
- #define SETUP_CODE						\
-    GET_XRB(xrb);						\
-    XMesaImage *img = xrb->ximage;
--#define RENDER_SPAN( span )					\
-+#define RENDER_SPAN( span ) {					\
-    GLuint i;							\
-    GLint x = span.x, y = YFLIP(xrb, span.y);			\
-    XDITHER_SETUP(y);						\
-@@ -365,7 +365,7 @@
-       span.green += span.greenStep;				\
-       span.blue += span.blueStep;				\
-       span.z += span.zStep;					\
--   }
-+   } }
- #include "swrast/s_tritemp.h"
- 
- 
-@@ -382,7 +382,7 @@
- #define BYTES_PER_ROW (xrb->ximage->bytes_per_line)
- #define SETUP_CODE						\
-    GET_XRB(xrb);
--#define RENDER_SPAN( span )					\
-+#define RENDER_SPAN( span ) {					\
-    GLuint i;							\
-    LOOKUP_SETUP;						\
-    for (i = 0; i < span.end; i++) {				\
-@@ -396,7 +396,7 @@
-       span.green += span.greenStep;				\
-       span.blue += span.blueStep;				\
-       span.z += span.zStep;					\
--   }
-+   } }
- #include "swrast/s_tritemp.h"
- 
- 
-@@ -414,7 +414,7 @@
- #define SETUP_CODE						\
-    XMesaContext xmesa = XMESA_CONTEXT(ctx);			\
-    GET_XRB(xrb);
--#define RENDER_SPAN( span )					\
-+#define RENDER_SPAN( span ) {					\
-    GLuint i;							\
-    GLint x = span.x, y = YFLIP(xrb, span.y);			\
-    for (i = 0; i < span.end; i++, x++) {			\
-@@ -428,7 +428,7 @@
-       span.green += span.greenStep;				\
-       span.blue += span.blueStep;				\
-       span.z += span.zStep;					\
--   }
-+   } }
- #include "swrast/s_tritemp.h"
- 
- 
-@@ -445,7 +445,7 @@
-    XMesaImage *img = xrb->ximage;				\
-    unsigned long pixel;						\
-    PACK_TRUECOLOR(pixel, v2->color[0], v2->color[1], v2->color[2]);
--#define RENDER_SPAN( span )					\
-+#define RENDER_SPAN( span ) {					\
-    GLuint i;							\
-    GLint x = span.x, y = YFLIP(xrb, span.y);			\
-    for (i = 0; i < span.end; i++, x++) {			\
-@@ -455,7 +455,7 @@
-          zRow[i] = z;						\
-       }								\
-       span.z += span.zStep;					\
--   }
-+   } }
- #include "swrast/s_tritemp.h"
- 
- 
-@@ -472,7 +472,7 @@
- #define SETUP_CODE					\
-    GET_XRB(xrb);					\
-    GLuint p = PACK_8B8G8R( v2->color[0], v2->color[1], v2->color[2] );
--#define RENDER_SPAN( span )				\
-+#define RENDER_SPAN( span ) {				\
-    GLuint i;						\
-    for (i = 0; i < span.end; i++) {			\
-       const DEPTH_TYPE z = FixedToDepth(span.z);	\
-@@ -481,7 +481,7 @@
-          zRow[i] = z;					\
-       }							\
-       span.z += span.zStep;				\
--   }
-+   } }
- #include "swrast/s_tritemp.h"
- 
- 
-@@ -498,7 +498,7 @@
- #define SETUP_CODE					\
-    GET_XRB(xrb);					\
-    GLuint p = PACK_8R8G8B( v2->color[0], v2->color[1], v2->color[2] );
--#define RENDER_SPAN( span )				\
-+#define RENDER_SPAN( span ) {				\
-    GLuint i;						\
-    for (i = 0; i < span.end; i++) {			\
-       const DEPTH_TYPE z = FixedToDepth(span.z);	\
-@@ -507,7 +507,7 @@
-          zRow[i] = z;					\
-       }							\
-       span.z += span.zStep;				\
--   }
-+   } }
- #include "swrast/s_tritemp.h"
- 
- 
-@@ -524,7 +524,7 @@
- #define SETUP_CODE					\
-    GET_XRB(xrb);					\
-    GLuint p = PACK_8R8G8B( v2->color[0], v2->color[1], v2->color[2] );
--#define RENDER_SPAN( span )			\
-+#define RENDER_SPAN( span ) {			\
-    GLuint i;					\
-    for (i = 0; i < span.end; i++) {		\
-       DEPTH_TYPE z = FixedToDepth(span.z);	\
-@@ -533,7 +533,7 @@
-          zRow[i] = z;				\
-       }						\
-       span.z += span.zStep;			\
--   }
-+   } }
- 
- #include "swrast/s_tritemp.h"
- 
-@@ -551,7 +551,7 @@
- #define SETUP_CODE					\
-    GET_XRB(xrb);					\
-    const GLubyte *color = v2->color;
--#define RENDER_SPAN( span )				\
-+#define RENDER_SPAN( span ) {				\
-    GLuint i;						\
-    for (i = 0; i < span.end; i++) {			\
-       const DEPTH_TYPE z = FixedToDepth(span.z);	\
-@@ -563,7 +563,7 @@
-          zRow[i] = z;					\
-       }							\
-       span.z += span.zStep;				\
--   }
-+   } }
- #include "swrast/s_tritemp.h"
- 
- 
-@@ -578,7 +578,7 @@
-    XMesaContext xmesa = XMESA_CONTEXT(ctx);			\
-    GET_XRB(xrb);						\
-    XMesaImage *img = xrb->ximage;
--#define RENDER_SPAN( span )					\
-+#define RENDER_SPAN( span ) {					\
-    GLuint i;							\
-    GLint x = span.x, y = YFLIP(xrb, span.y);			\
-    for (i = 0; i < span.end; i++, x++) {			\
-@@ -591,7 +591,7 @@
-          zRow[i] = z;						\
-       }								\
-       span.z += span.zStep;					\
--   }
-+   } }
- #include "swrast/s_tritemp.h"
- 
- 
-@@ -608,7 +608,7 @@
- #define SETUP_CODE					\
-    GET_XRB(xrb);					\
-    GLushort p = PACK_5R6G5B( v2->color[0], v2->color[1], v2->color[2] );
--#define RENDER_SPAN( span )				\
-+#define RENDER_SPAN( span ) {				\
-    GLuint i;						\
-    for (i = 0; i < span.end; i++) {			\
-       const DEPTH_TYPE z = FixedToDepth(span.z);	\
-@@ -617,7 +617,7 @@
-          zRow[i] = z;					\
-       }							\
-       span.z += span.zStep;				\
--   }
-+   } }
- #include "swrast/s_tritemp.h"
- 
- 
-@@ -635,7 +635,7 @@
-    XMesaContext xmesa = XMESA_CONTEXT(ctx);			\
-    GET_XRB(xrb);						\
-    const GLubyte *color = v2->color;
--#define RENDER_SPAN( span )					\
-+#define RENDER_SPAN( span ) {					\
-    GLuint i;							\
-    GLint x = span.x, y = YFLIP(xrb, span.y);			\
-    for (i = 0; i < span.end; i++, x++) {			\
-@@ -646,7 +646,7 @@
-          zRow[i] = z;						\
-       }								\
-       span.z += span.zStep;					\
--   }
-+   } }
- #include "swrast/s_tritemp.h"
- 
- 
-@@ -663,7 +663,7 @@
- #define SETUP_CODE						\
-    GET_XRB(xrb);						\
-    FLAT_DITHER_SETUP( v2->color[0], v2->color[1], v2->color[2] );
--#define RENDER_SPAN( span )					\
-+#define RENDER_SPAN( span ) {					\
-    GLuint i;							\
-    GLint x = span.x, y = YFLIP(xrb, span.y);			\
-    FLAT_DITHER_ROW_SETUP(YFLIP(xrb, y));			\
-@@ -674,7 +674,7 @@
-          zRow[i] = z;						\
-       }								\
-       span.z += span.zStep;					\
--   }
-+   } }
- #include "swrast/s_tritemp.h"
- 
- 
-@@ -689,7 +689,7 @@
-    GET_XRB(xrb);					\
-    XMesaImage *img = xrb->ximage;		\
-    FLAT_DITHER_SETUP( v2->color[0], v2->color[1], v2->color[2] );
--#define RENDER_SPAN( span )					\
-+#define RENDER_SPAN( span ) {					\
-    GLuint i;							\
-    GLint x = span.x, y = YFLIP(xrb, span.y);	\
-    FLAT_DITHER_ROW_SETUP(y);					\
-@@ -701,7 +701,7 @@
-          zRow[i] = z;						\
-       }								\
-       span.z += span.zStep;					\
--   }
-+   } }
- #include "swrast/s_tritemp.h"
- 
- 
-@@ -721,7 +721,7 @@
-    GLubyte r = v2->color[0];					\
-    GLubyte g = v2->color[1];					\
-    GLubyte b = v2->color[2];
--#define RENDER_SPAN( span )					\
-+#define RENDER_SPAN( span ) {					\
-    GLuint i;							\
-    GLint x = span.x, y = YFLIP(xrb, span.y);	\
-    for (i = 0; i < span.end; i++, x++) {			\
-@@ -731,7 +731,7 @@
-          zRow[i] = z;						\
-       }								\
-       span.z += span.zStep;					\
--   }
-+   } }
- #include "swrast/s_tritemp.h"
- 
- 
-@@ -752,7 +752,7 @@
-    GLubyte g = v2->color[1];				\
-    GLubyte b = v2->color[2];				\
-    GLubyte p = LOOKUP(r,g,b);
--#define RENDER_SPAN( span )				\
-+#define RENDER_SPAN( span ) {				\
-    GLuint i;						\
-    for (i = 0; i < span.end; i++) {			\
-       const DEPTH_TYPE z = FixedToDepth(span.z);	\
-@@ -761,7 +761,7 @@
-          zRow[i] = z;					\
-       }							\
-       span.z += span.zStep;				\
--   }
-+   } }
- #include "swrast/s_tritemp.h"
- 
- 
-@@ -775,7 +775,7 @@
-    XMesaContext xmesa = XMESA_CONTEXT(ctx);			\
-    GET_XRB(xrb);						\
-    XMesaImage *img = xrb->ximage;
--#define RENDER_SPAN( span )					\
-+#define RENDER_SPAN( span ) {					\
-    GLuint i;							\
-    GLint x = span.x, y = YFLIP(xrb, span.y);	\
-    for (i = 0; i < span.end; i++, x++) {			\
-@@ -786,7 +786,7 @@
-       span.red += span.redStep;					\
-       span.green += span.greenStep;				\
-       span.blue += span.blueStep;				\
--   }
-+   } }
- #include "swrast/s_tritemp.h"
- 
- 
-@@ -801,7 +801,7 @@
- #define BYTES_PER_ROW (xrb->ximage->bytes_per_line)
- #define SETUP_CODE						\
-    GET_XRB(xrb);
--#define RENDER_SPAN( span )					\
-+#define RENDER_SPAN( span ) {					\
-    GLuint i;							\
-    for (i = 0; i < span.end; i++) {				\
-       pRow[i] = PACK_8B8G8R(FixedToInt(span.red),		\
-@@ -809,7 +809,7 @@
-       span.red += span.redStep;					\
-       span.green += span.greenStep;				\
-       span.blue += span.blueStep;				\
--   }
-+   } }
- #include "swrast/s_tritemp.h"
- 
- 
-@@ -824,7 +824,7 @@
- #define BYTES_PER_ROW (xrb->ximage->bytes_per_line)
- #define SETUP_CODE						\
-    GET_XRB(xrb);
--#define RENDER_SPAN( span )					\
-+#define RENDER_SPAN( span ) {					\
-    GLuint i;							\
-    for (i = 0; i < span.end; i++) {				\
-       pRow[i] = PACK_8R8G8B(FixedToInt(span.red),		\
-@@ -832,7 +832,7 @@
-       span.red += span.redStep;					\
-       span.green += span.greenStep;				\
-       span.blue += span.blueStep;				\
--   }
-+   } }
- #include "swrast/s_tritemp.h"
- 
- 
-@@ -847,7 +847,7 @@
- #define BYTES_PER_ROW (xrb->ximage->bytes_per_line)
- #define SETUP_CODE						\
-    GET_XRB(xrb);
--#define RENDER_SPAN( span )					\
-+#define RENDER_SPAN( span ) {					\
-    GLuint i;							\
-    for (i = 0; i < span.end; i++) {				\
-       pRow[i] = PACK_8R8G8B(FixedToInt(span.red),		\
-@@ -855,7 +855,7 @@
-       span.red += span.redStep;					\
-       span.green += span.greenStep;				\
-       span.blue += span.blueStep;				\
--   }
-+   } }
- #include "swrast/s_tritemp.h"
- 
- 
-@@ -870,7 +870,7 @@
- #define BYTES_PER_ROW (xrb->ximage->bytes_per_line)
- #define SETUP_CODE					\
-    GET_XRB(xrb);
--#define RENDER_SPAN( span )				\
-+#define RENDER_SPAN( span ) {				\
-    GLuint i;						\
-    PIXEL_TYPE *pixel = pRow;				\
-    for (i = 0; i < span.end; i++, pixel++) {		\
-@@ -880,7 +880,7 @@
-       span.red += span.redStep;				\
-       span.green += span.greenStep;			\
-       span.blue += span.blueStep;			\
--   }
-+   } }
- #include "swrast/s_tritemp.h"
- 
- 
-@@ -894,7 +894,7 @@
-    XMesaContext xmesa = XMESA_CONTEXT(ctx);			\
-    GET_XRB(xrb);						\
-    XMesaImage *img = xrb->ximage;
--#define RENDER_SPAN( span )					\
-+#define RENDER_SPAN( span ) {					\
-    GLuint i;							\
-    GLint x = span.x, y = YFLIP(xrb, span.y);	\
-    for (i = 0; i < span.end; i++, x++) {			\
-@@ -905,7 +905,7 @@
-       span.red += span.redStep;					\
-       span.green += span.greenStep;				\
-       span.blue += span.blueStep;				\
--   }
-+   } }
- #include "swrast/s_tritemp.h"
- 
- 
-@@ -920,7 +920,7 @@
- #define BYTES_PER_ROW (xrb->ximage->bytes_per_line)
- #define SETUP_CODE						\
-    GET_XRB(xrb);
--#define RENDER_SPAN( span )					\
-+#define RENDER_SPAN( span ) {					\
-    GLuint i;							\
-    for (i = 0; i < span.end; i++) {				\
-       pRow[i] = (PIXEL_TYPE) PACK_5R6G5B(FixedToInt(span.red),	\
-@@ -928,7 +928,7 @@
-       span.red += span.redStep;					\
-       span.green += span.greenStep;				\
-       span.blue += span.blueStep;				\
--   }
-+   } }
- #include "swrast/s_tritemp.h"
- 
- 
-@@ -944,7 +944,7 @@
- #define SETUP_CODE						\
-    XMesaContext xmesa = XMESA_CONTEXT(ctx);			\
-    GET_XRB(xrb);
--#define RENDER_SPAN( span )					\
-+#define RENDER_SPAN( span ) {					\
-    GLuint i;							\
-    GLint x = span.x, y = YFLIP(xrb, span.y);	\
-    for (i = 0; i < span.end; i++, x++) {			\
-@@ -953,7 +953,7 @@
-       span.red += span.redStep;					\
-       span.green += span.greenStep;				\
-       span.blue += span.blueStep;				\
--   }
-+   } }
- #include "swrast/s_tritemp.h"
- 
- 
-@@ -968,7 +968,7 @@
- #define BYTES_PER_ROW (xrb->ximage->bytes_per_line)
- #define SETUP_CODE						\
-    GET_XRB(xrb);
--#define RENDER_SPAN( span )					\
-+#define RENDER_SPAN( span ) {					\
-    GLuint i;							\
-    GLint x = span.x, y = YFLIP(xrb, span.y);	\
-    XDITHER_SETUP(y);						\
-@@ -978,7 +978,7 @@
-       span.red += span.redStep;					\
-       span.green += span.greenStep;				\
-       span.blue += span.blueStep;				\
--   }
-+   } }
- #include "swrast/s_tritemp.h"
- 
- 
-@@ -991,7 +991,7 @@
- #define SETUP_CODE						\
-    GET_XRB(xrb);						\
-    XMesaImage *img = xrb->ximage;
--#define RENDER_SPAN( span )					\
-+#define RENDER_SPAN( span ) {					\
-    GLuint i;							\
-    GLint x = span.x, y = YFLIP(xrb, span.y);	\
-    XDITHER_SETUP(y);						\
-@@ -1002,7 +1002,7 @@
-       span.red += span.redStep;					\
-       span.green += span.greenStep;				\
-       span.blue += span.blueStep;				\
--   }
-+   } }
- #include "swrast/s_tritemp.h"
- 
- 
-@@ -1017,7 +1017,7 @@
- #define BYTES_PER_ROW (xrb->ximage->bytes_per_line)
- #define SETUP_CODE						\
-    GET_XRB(xrb);
--#define RENDER_SPAN( span )					\
-+#define RENDER_SPAN( span ) {					\
-    GLuint i;							\
-    LOOKUP_SETUP;						\
-    for (i = 0; i < span.end; i++) {				\
-@@ -1026,7 +1026,7 @@
-       span.red += span.redStep;					\
-       span.green += span.greenStep;				\
-       span.blue += span.blueStep;				\
--   }
-+   } }
- #include "swrast/s_tritemp.h"
- 
- 
-@@ -1042,7 +1042,7 @@
- #define SETUP_CODE						\
-    XMesaContext xmesa = XMESA_CONTEXT(ctx);			\
-    GET_XRB(xrb);
--#define RENDER_SPAN( span )					\
-+#define RENDER_SPAN( span ) {					\
-    GLuint i;							\
-    GLint x = span.x, y = YFLIP(xrb, span.y);	\
-    for (i = 0; i < span.end; i++, x++) {			\
-@@ -1051,7 +1051,7 @@
-       span.red += span.redStep;					\
-       span.green += span.greenStep;				\
-       span.blue += span.blueStep;				\
--   }
-+   } }
- #include "swrast/s_tritemp.h"
- 
- 
-@@ -1066,12 +1066,12 @@
-    XMesaImage *img = xrb->ximage;				\
-    unsigned long pixel;						\
-    PACK_TRUECOLOR(pixel, v2->color[0], v2->color[1], v2->color[2]);
--#define RENDER_SPAN( span )					\
-+#define RENDER_SPAN( span ) {					\
-    GLuint i;							\
-    GLint x = span.x, y = YFLIP(xrb, span.y);	\
-    for (i = 0; i < span.end; i++, x++) {			\
-       XMesaPutPixel(img, x, y, pixel);				\
--   }
-+   } }
- #include "swrast/s_tritemp.h"
- 
- 
-@@ -1087,11 +1087,11 @@
-    GET_XRB(xrb);					\
-    unsigned long p = PACK_8B8G8R( v2->color[0],		\
- 		 v2->color[1], v2->color[2] );
--#define RENDER_SPAN( span )				\
-+#define RENDER_SPAN( span ) {				\
-    GLuint i;						\
-    for (i = 0; i < span.end; i++) {			\
-       pRow[i] = (PIXEL_TYPE) p;				\
--   }
-+   } }
- #include "swrast/s_tritemp.h"
- 
- 
-@@ -1107,11 +1107,11 @@
-    GET_XRB(xrb);					\
-    unsigned long p = PACK_8R8G8B( v2->color[0],		\
- 		 v2->color[1], v2->color[2] );
--#define RENDER_SPAN( span )				\
-+#define RENDER_SPAN( span ) {				\
-    GLuint i;						\
-    for (i = 0; i < span.end; i++) {			\
-       pRow[i] = (PIXEL_TYPE) p;				\
--   }
-+   } }
- #include "swrast/s_tritemp.h"
- 
- 
-@@ -1127,11 +1127,11 @@
-    GET_XRB(xrb);					\
-    unsigned long p = PACK_8R8G8B( v2->color[0],		\
- 		 v2->color[1], v2->color[2] );
--#define RENDER_SPAN( span )				\
-+#define RENDER_SPAN( span ) {				\
-    GLuint i;						\
-    for (i = 0; i < span.end; i++) {			\
-       pRow[i] = (PIXEL_TYPE) p;				\
--   }
-+   } }
- #include "swrast/s_tritemp.h"
- 
- 
-@@ -1146,14 +1146,14 @@
- #define SETUP_CODE					\
-    GET_XRB(xrb);					\
-    const GLubyte *color = v2->color;
--#define RENDER_SPAN( span )				\
-+#define RENDER_SPAN( span ) {				\
-    GLuint i;						\
-    PIXEL_TYPE *pixel = pRow;				\
-    for (i = 0; i < span.end; i++, pixel++) {		\
-       pixel->r = color[RCOMP];				\
-       pixel->g = color[GCOMP];				\
-       pixel->b = color[BCOMP];				\
--   }
-+   } }
- #include "swrast/s_tritemp.h"
- 
- 
-@@ -1166,7 +1166,7 @@
-    XMesaContext xmesa = XMESA_CONTEXT(ctx);			\
-    GET_XRB(xrb);						\
-    XMesaImage *img = xrb->ximage;
--#define RENDER_SPAN( span )					\
-+#define RENDER_SPAN( span ) {					\
-    GLuint i;							\
-    GLint x = span.x, y = YFLIP(xrb, span.y);	\
-    for (i = 0; i < span.end; i++, x++) {			\
-@@ -1174,7 +1174,7 @@
-       PACK_TRUEDITHER(p, x, y, v2->color[0],			\
-                v2->color[1], v2->color[2] );			\
-       XMesaPutPixel(img, x, y, p);				\
--   }
-+   } }
- #include "swrast/s_tritemp.h"
- 
- 
-@@ -1190,11 +1190,11 @@
-    GET_XRB(xrb);					\
-    unsigned long p = PACK_5R6G5B( v2->color[0],		\
- 		 v2->color[1], v2->color[2] );
--#define RENDER_SPAN( span )				\
-+#define RENDER_SPAN( span ) {				\
-    GLuint i;						\
-    for (i = 0; i < span.end; i++) {			\
-       pRow[i] = (PIXEL_TYPE) p;				\
--   }
-+   } }
- #include "swrast/s_tritemp.h"
- 
- 
-@@ -1210,13 +1210,13 @@
-    XMesaContext xmesa = XMESA_CONTEXT(ctx);			\
-    GET_XRB(xrb);						\
-    const GLubyte *color = v2->color;
--#define RENDER_SPAN( span )					\
-+#define RENDER_SPAN( span ) {					\
-    GLuint i;							\
-    GLint x = span.x, y = YFLIP(xrb, span.y);	\
-    for (i = 0; i < span.end; i++, x++) {			\
-       PACK_TRUEDITHER(pRow[i], x, y, color[RCOMP],		\
-          color[GCOMP], color[BCOMP]);				\
--   }
-+   } }
- #include "swrast/s_tritemp.h"
- 
- 
-@@ -1231,13 +1231,13 @@
- #define SETUP_CODE						\
-    GET_XRB(xrb);						\
-    FLAT_DITHER_SETUP( v2->color[0], v2->color[1], v2->color[2] );
--#define RENDER_SPAN( span )					\
-+#define RENDER_SPAN( span ) {					\
-    GLuint i;							\
-    GLint x = span.x, y = YFLIP(xrb, span.y);	\
-    FLAT_DITHER_ROW_SETUP(YFLIP(xrb, y));		\
-    for (i = 0; i < span.end; i++, x++) {			\
-       pRow[i] = (PIXEL_TYPE) FLAT_DITHER(x);			\
--   }
-+   } }
- #include "swrast/s_tritemp.h"
- 
- 
-@@ -1250,14 +1250,14 @@
-    GET_XRB(xrb);						\
-    XMesaImage *img = xrb->ximage;				\
-    FLAT_DITHER_SETUP( v2->color[0], v2->color[1], v2->color[2] );
--#define RENDER_SPAN( span )					\
-+#define RENDER_SPAN( span ) {					\
-    GLuint i;							\
-    GLint x = span.x, y = YFLIP(xrb, span.y);	\
-    FLAT_DITHER_ROW_SETUP(y);					\
-    for (i = 0; i < span.end; i++, x++) {			\
-       unsigned long p = FLAT_DITHER(x);				\
-       XMesaPutPixel(img, x, y, p );				\
--   }
-+   } }
- #include "swrast/s_tritemp.h"
- 
- 
-@@ -1275,12 +1275,12 @@
-    GLubyte r = v2->color[0];					\
-    GLubyte g = v2->color[1];					\
-    GLubyte b = v2->color[2];
--#define RENDER_SPAN( span )					\
-+#define RENDER_SPAN( span ) {					\
-    GLuint i;							\
-    GLint x = span.x, y = YFLIP(xrb, span.y);	\
-    for (i = 0; i < span.end; i++, x++) {			\
-       pRow[i] = (PIXEL_TYPE) DITHER_HPCR(x, y, r, g, b);	\
--   }
-+   } }
- #include "swrast/s_tritemp.h"
- 
- 
-@@ -1299,11 +1299,11 @@
-    GLubyte g = v2->color[1];				\
-    GLubyte b = v2->color[2];				\
-    GLubyte p = LOOKUP(r,g,b);
--#define RENDER_SPAN( span )         	 		\
-+#define RENDER_SPAN( span ) {        	 		\
-    GLuint i;						\
-    for (i = 0; i < span.end; i++) {			\
-       pRow[i] = (PIXEL_TYPE) p;				\
--   }
-+   } }
- #include "swrast/s_tritemp.h"
- 
- 
Index: graphics/MesaLib/patches/patch-am
===================================================================
RCS file: /cvsroot/pkgsrc/graphics/MesaLib/patches/patch-am,v
retrieving revision 1.5
diff -u -d -r1.5 patch-am
--- graphics/MesaLib/patches/patch-am	13 Apr 2007 09:12:02 -0000	1.5
+++ graphics/MesaLib/patches/patch-am	5 Aug 2007 04:55:48 -0000
@@ -1,26 +1,13 @@
-$NetBSD: pkgsrc-mesa.diff,v 1.2 2007/08/05 04:56:17 bsadewitz Exp $
+$NetBSD: pkgsrc-mesa.diff,v 1.2 2007/08/05 04:56:17 bsadewitz Exp $
 
---- include/GL/glxext.h.orig	2005-11-07 22:20:29.000000000 +0100
+--- include/GL/glxext.h.orig	2007-06-21 18:10:53.000000000 -0400
 +++ include/GL/glxext.h
-@@ -331,10 +331,10 @@ typedef struct {
- } GLXBufferClobberEventSGIX;
- #endif
- 
--#if defined(__sun__)
-+#if defined(__sun__) || defined(__digital__)
+@@ -389,7 +389,7 @@ typedef struct {
+ #elif defined(__sun__) || defined(__digital__)
  #include <inttypes.h>
  #if defined(__STDC__)
 -#if defined(__arch64__)
 +#if defined(__arch64__) || defined(_LP64)
  typedef long int int64_t;
+ typedef unsigned long int uint64_t;
  #else
- typedef long long int int64_t;   
-@@ -343,7 +343,7 @@ typedef long long int int64_t;   
- #elif defined(__UNIXOS2__) || defined(__SOL64__)
- typedef long int int32_t;
- typedef long long int int64_t;
--#elif defined( __VMS )
-+#elif defined( __VMS ) || defined(__sgi)
- #include <inttypes.h>
- #elif defined(__SCO__) || defined(__USLC__)
- #include <stdint.h>
Index: graphics/glx-utils/Makefile
===================================================================
RCS file: /cvsroot/pkgsrc/graphics/glx-utils/Makefile,v
retrieving revision 1.2
diff -u -d -r1.2 Makefile
--- graphics/glx-utils/Makefile	1 Aug 2006 21:40:20 -0000	1.2
+++ graphics/glx-utils/Makefile	5 Aug 2007 04:55:48 -0000
@@ -23,7 +23,7 @@
 		-L../../lib -lGLU -lGL -lm -lXext ${PTHREAD_LIBS} -o glxinfo
 
 do-install:
-	${INSTALL_PROGRAM} ${WRKSRC}/progs/xdemos/glxgears ${PREFIX}/bin/
-	${INSTALL_PROGRAM} ${WRKSRC}/progs/xdemos/glxinfo ${PREFIX}/bin/
+	${INSTALL_PROGRAM} ${WRKSRC}/progs/xdemos/glxgears ${DESTDIR}${PREFIX}/bin/
+	${INSTALL_PROGRAM} ${WRKSRC}/progs/xdemos/glxinfo ${DESTDIR}${PREFIX}/bin/
 
 .include "../../mk/bsd.pkg.mk"
Index: graphics/glx-utils/distinfo
===================================================================
RCS file: /cvsroot/pkgsrc/graphics/glx-utils/distinfo,v
retrieving revision 1.1.1.1
diff -u -d -r1.1.1.1 distinfo
--- graphics/glx-utils/distinfo	13 Jun 2006 23:44:09 -0000	1.1.1.1
+++ graphics/glx-utils/distinfo	5 Aug 2007 04:55:48 -0000
@@ -1,5 +1,5 @@
 $NetBSD: pkgsrc-mesa.diff,v 1.2 2007/08/05 04:56:17 bsadewitz Exp $
 
-SHA1 (Mesa-6.4.2/MesaDemos-6.4.2.tar.bz2) = 35b1ff78fc1bd1c303be754ad2ff4252ad6c0258
-RMD160 (Mesa-6.4.2/MesaDemos-6.4.2.tar.bz2) = 82e1dafd39abbe1c0e1de49adcff00dec19c6c1a
-Size (Mesa-6.4.2/MesaDemos-6.4.2.tar.bz2) = 814178 bytes
+SHA1 (Mesa-7.0.1/MesaDemos-7.0.1.tar.bz2) = 4d6cb158b58dbda9411d00e99a01031e13cae2ec
+RMD160 (Mesa-7.0.1/MesaDemos-7.0.1.tar.bz2) = 58537c690d811da09f788bf9b5b5bd999e5445c6
+Size (Mesa-7.0.1/MesaDemos-7.0.1.tar.bz2) = 1340949 bytes
