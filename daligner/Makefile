# $NetBSD$

###########################################################
#               Generated by fbsd2pkg                     #
###########################################################

## Must use the same version of dazz_db, daligner, pypeflow, and falcon!

DISTNAME=	daligner-${PORTVERSION}
CATEGORIES=	biology
MASTER_SITES=	http://acadix.biz/Ports/distfiles/
EXTRACT_SUFX=	.tar.xz

MAINTAINER=	bacon@NetBSD.org

COMMENT=	Find all significant local alignments between reads
# Double-check this
LICENSE=	modified-bsd

# Pessimistic assumption.  Test and change if possible.
# MAKE_JOBS_SAFE=	no

# Just assuming C and C++: Adjust this!
USE_LANGUAGES=	c
USE_TOOLS+=	gmake

# OS X Snow Leopard doesn't suppot no-unused-result and dies of an
# internal compiler error if we use -O2 or higher
SUBST_CLASSES+=		makefile
SUBST_STAGE.makefile=	post-patch
SUBST_FILES.makefile=	${WRKSRC}/GNUmakefile
SUBST_SED.makefile=	-e 's|-Wno-unused-result||g'
SUBST_SED.makefile+=	-e 's|-O3|-O|g'

CFLAGS+=	-I${PREFIX}/include
MAKE_FILE=	GNUmakefile

PORTVERSION=	2015.10.28

AUTO_MKDIRS=	yes

post-patch:
	for f in ${WRKSRC}/py_utils/*.py; do \
		${PRINTF} "#!${PYTHONBIN}\\n" > $$f.temp; \
		${CAT} $$f >> $$f.temp; \
		${MV} -f $$f.temp $$f; \
	done

do-install:
	${INSTALL_PROGRAM} \
		${WRKSRC}/DB2Falcon \
		${WRKSRC}/HPCdaligner \
		${WRKSRC}/HPCmapper \
		${WRKSRC}/LA4Falcon \
		${WRKSRC}/LAcat \
		${WRKSRC}/LAcheck \
		${WRKSRC}/LAmerge \
		${WRKSRC}/LAshow \
		${WRKSRC}/LAsort \
		${WRKSRC}/LAsplit \
		${WRKSRC}/daligner \
		${WRKSRC}/daligner_p \
		${DESTDIR}${PREFIX}/bin
	${INSTALL_SCRIPT} \
		${WRKSRC}/py_utils/*.py \
		${DESTDIR}${PREFIX}/bin
	${INSTALL_DATA} \
		${WRKSRC}/*.h \
		${DESTDIR}${PREFIX}/include
	${AR} rs ${DESTDIR}${PREFIX}/lib/libdaligner.a \
		${WRKSRC}/align.o

.include "../../wip/dazz_db/buildlink3.mk"
.include "../../mk/bsd.pkg.mk"
