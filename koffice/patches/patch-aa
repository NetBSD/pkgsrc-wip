$NetBSD: patch-aa,v 1.3 2011/01/16 11:08:01 thomasklausner Exp $

Fix build with png-1.5.

--- krita/ui/kis_png_converter.cpp.orig	2010-12-29 10:38:31.000000000 +0000
+++ krita/ui/kis_png_converter.cpp
@@ -30,6 +30,7 @@
 
 #include <limits.h>
 #include <stdio.h>
+#include <zlib.h>
 
 #include <QBuffer>
 #include <QFile>
@@ -453,17 +454,17 @@ KisImageBuilder_Result KisPNGConverter::
     png_read_info(png_ptr, info_ptr);
 
 
-    if (info_ptr->color_type == PNG_COLOR_TYPE_GRAY && info_ptr->bit_depth < 8) {
+    if (png_get_color_type(png_ptr, info_ptr) == PNG_COLOR_TYPE_GRAY && png_get_bit_depth(png_ptr, info_ptr) < 8) {
         png_set_expand(png_ptr);
     }
 
-    if (info_ptr->color_type == PNG_COLOR_TYPE_PALETTE && info_ptr->bit_depth < 8) {
+    if (png_get_color_type(png_ptr, info_ptr) == PNG_COLOR_TYPE_PALETTE && png_get_bit_depth(png_ptr, info_ptr) < 8) {
         png_set_packing(png_ptr);
     }
 
 
-    if (info_ptr->color_type != PNG_COLOR_TYPE_PALETTE &&
-            (info_ptr->valid & PNG_INFO_tRNS)) {
+    if (png_get_color_type(png_ptr, info_ptr) != PNG_COLOR_TYPE_PALETTE &&
+            (png_get_valid(png_ptr, info_ptr, PNG_INFO_tRNS))) {
         png_set_expand(png_ptr);
     }
     png_read_update_info(png_ptr, info_ptr);
@@ -489,7 +490,8 @@ KisImageBuilder_Result KisPNGConverter::
     bool hasalpha = (color_type == PNG_COLOR_TYPE_RGB_ALPHA || color_type == PNG_COLOR_TYPE_GRAY_ALPHA);
 
     // Read image profile
-    png_charp profile_name, profile_data;
+    png_charp profile_name;
+    png_bytep profile_data;
     int compression_type;
     png_uint_32 proflen;
 
@@ -938,7 +940,7 @@ KisImageBuilder_Result KisPNGConverter::
         } else { // Profile
             char* name = new char[(*it)->type().length()+1];
             strcpy(name, (*it)->type().toAscii());
-            png_set_iCCP(png_ptr, info_ptr, name, PNG_COMPRESSION_TYPE_BASE, (char*)(*it)->annotation().data(), (*it) -> annotation() . size());
+            png_set_iCCP(png_ptr, info_ptr, name, PNG_COMPRESSION_TYPE_BASE, (const png_bytep)(*it)->annotation().data(), (*it) -> annotation() . size());
         }
         ++it;
     }
