# $NetBSD$
#
###########################################################
#                  Generated by fbsd2pkg                  #
#              Tue Sep 28 11:27:06 CDT 2021               #
###########################################################

DISTNAME=	lpjs-0.0.2.6
CATEGORIES=	sysutils
MASTER_SITES=	${MASTER_SITE_GITHUB:=outpaddling/}
GITHUB_PROJECT=	LPJS
GITHUB_TAG=	d465f4d2525e9f39683030868b511742405dc10a

OWNER=		bacon@NetBSD.org
HOMEPAGE=	https://github.com/outpaddling/LPJS/
COMMENT=	Lightweight, Portable Job Scheduler
LICENSE=	2-clause-bsd

TOOL_DEPENDS=	realpath>0:../../wip/realpath
DEPENDS=	auto-admin>=0.8.0.31:../../wip/auto-admin \
		runas>0:../../sysutils/runas

# FIXME: WRKSRC is handled differently for releases and tags
# WRKSRC=		${WRKDIR}/LPJS-${PKGVERSION_NOREV}
# Force install with full debug info until release
CFLAGS+=	-g
MAKE_FLAGS+=	INSTALL_UNSTRIPPED=yes
LDFLAGS.SunOS=	-lresolv -lsocket -lnsl

EGDIR=		${PREFIX}/share/examples/lpjs
OWN_DIRS=	${PKG_SYSCONFDIR}/lpjs
CONF_FILES=	${EGDIR}/config.sample ${PKG_SYSCONFDIR}/lpjs/config

PKG_GROUPS=		lpjs
PKG_USERS=		lpjs:lpjs
PKG_GECOS.slurm=	LPJS daemon
PKG_SHELL.slurm=	${NOLOGIN}
RCD_SCRIPTS+=		lpjs_dispatchd lpjs_compd

INSTALLATION_DIRS=	share/examples/lpjs

pre-build:
	cd ${WRKSRC} && ${MAKE} depend PREFIX=${PREFIX}

post-install:
	${MV} ${DESTDIR}${PREFIX}/etc/lpjs/config.sample ${DESTDIR}${EGDIR}

.include "../../wip/libxtend/buildlink3.mk"
.include "../../wip/munge/buildlink3.mk"
.include "../../mk/bsd.pkg.mk"
