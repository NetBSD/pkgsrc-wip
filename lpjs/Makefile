# $NetBSD$
#
###########################################################
#                  Generated by fbsd2pkg                  #
#              Tue Sep 28 11:27:06 CDT 2021               #
###########################################################

DISTNAME=	lpjs-0.0.3.29
CATEGORIES=	sysutils
MASTER_SITES=	${MASTER_SITE_GITHUB:=outpaddling/}
GITHUB_PROJECT=	LPJS
GITHUB_TAG=	f9dd3fb1baae8c17f61f04b2ba5d5bbbdd07b62c

OWNER=		bacon@NetBSD.org
HOMEPAGE=	https://github.com/outpaddling/LPJS/
COMMENT=	Lightweight, Portable Job Scheduler
LICENSE=	2-clause-bsd

TOOL_DEPENDS=	realpath>0:../../wip/realpath
DEPENDS=	auto-admin>=0.8.0.31:../../wip/auto-admin \
		runas>0:../../sysutils/runas

# FIXME: WRKSRC is handled differently for releases and tags
# WRKSRC=		${WRKDIR}/LPJS-${PKGVERSION_NOREV}
# Force install with full debug info until release
CFLAGS+=	-g
MAKE_FLAGS+=	INSTALL_UNSTRIPPED=yes
LDFLAGS.SunOS=	-lresolv -lsocket -lnsl

LPJS_USER=		lpjs
LPJS_GROUP=		${LPJS_USER}

LPJS_LOG_DIR?=		${PREFIX}/var/log/lpjs
LPJS_SPOOL_DIR?=	${PREFIX}/var/spool/lpjs
LPJS_ETC_DIR?=		${PREFIX}/etc/lpjs

PKG_GROUPS+=		${LPJS_GROUP}
PKG_USERS+=		${LPJS_USER}:${LPJS_GROUP}
PKG_GECOS.lpjs=		LPJS daemon
PKG_SHELL.lpjs=		${NOLOGIN}

OWN_DIRS_PERMS+=	${LPJS_LOG_DIR} ${LPJS_USER} ${LPJS_GROUP} 0755
OWN_DIRS_PERMS+=	${LPJS_SPOOL_DIR} ${LPJS_USER} ${LPJS_GROUP} 0755
OWN_DIRS_PERMS+=	${LPJS_ETC_DIR} ${LPJS_USER} ${LPJS_GROUP} 0755
OWN_DIRS_PERMS+=	${LPJS_ETC_DIR} ${LPJS_USER} ${LPJS_GROUP} 0755

EGDIR=			${PREFIX}/share/examples/lpjs

CONF_FILES_PERMS=	${EGDIR}/config.sample ${PKG_SYSCONFDIR}/lpjs/config ${LPJS_USER} ${LPJS_GROUP} 0644

RCD_SCRIPTS=		lpjs_dispatchd lpjs_compd
PKG_RCD_SCRIPTS=	yes

INSTALLATION_DIRS=	share/examples/lpjs

pre-build:
	cd ${WRKSRC} && ${MAKE} depend PREFIX=${PREFIX}

post-install:
	${MV} ${DESTDIR}${PREFIX}/etc/lpjs/config.sample ${DESTDIR}${EGDIR}

.include "../../wip/libxtend/buildlink3.mk"
.include "../../wip/munge/buildlink3.mk"
.include "../../mk/bsd.pkg.mk"
