$NetBSD: patch-ab,v 1.3 2007/08/07 03:56:41 bsadewitz Exp $

--- configure.ac.orig	2007-07-31 23:55:59.000000000 -0400
+++ configure.ac
@@ -286,7 +286,7 @@ case $host_cpu in
 	case $host_os in
 	        darwin*)	use_x86_asm="no" ;;
 		*linux*)	DEFAULT_INT10=vm86 ;;
-		*freebsd*)	AC_DEFINE(USE_DEV_IO) ;;
+		*freebsd* | *dragonfly*)	AC_DEFINE(USE_DEV_IO) ;;
 		*netbsd*)	AC_DEFINE(USE_I386_IOPL)
 				SYS_LIBS=-li386
 				;;
@@ -617,7 +617,7 @@ XEXT_INC='-I$(top_srcdir)/Xext'
 XEXT_LIB='$(top_builddir)/Xext/libXext.la'
 XEXTXORG_LIB='$(top_builddir)/Xext/libXextbuiltin.la'
 
-PIXMAN="[pixman >= 0.9.2]"
+PIXMAN="[pixman-1 >= 0.9.4]"
 
 dnl Core modules for most extensions, et al.
 REQUIRED_MODULES="[randrproto >= 1.2] renderproto [fixesproto >= 4.0] [damageproto >= 1.1] xcmiscproto xextproto [xproto >= 7.0.9] xtrans [scrnsaverproto >= 1.1] bigreqsproto resourceproto fontsproto [inputproto >= 1.4.2] [kbproto >= 1.0.3]"
@@ -1045,7 +1045,7 @@ if test "x$GCC" = "xyes"; then
        fi
        XSERVER_CFLAGS="$GCC_WARNINGS $XSERVER_CFLAGS"
 
-       LD_EXPORT_SYMBOLS_FLAG="-rdynamic"
+       LD_EXPORT_SYMBOLS_FLAG="$EXPORT_SYMBOLS_LDFLAGS"
 fi
 case $host_os in
        darwin*)
@@ -1070,6 +1070,9 @@ if ! test "x$have_clock_gettime" = xno; 
         CLOCK_LIBS=""
     fi
 
+    LIBS_SAVE="$LIBS"
+    LIBS="$CLOCK_LIBS"
+
     AC_RUN_IFELSE([
 #define _POSIX_C_SOURCE 199309L
 #include <time.h>
@@ -1084,6 +1087,8 @@ int main(int argc, char *argv[]) {
 }
     ], [MONOTONIC_CLOCK=yes], [MONOTONIC_CLOCK=no],
        [MONOTONIC_CLOCK="cross compiling"])
+
+    LIBS="$LIBS_SAVE"
 else
     MONOTONIC_CLOCK=no
 fi
@@ -1376,7 +1381,7 @@ return 0;}
 			;;
 		esac
 		;;
-	  freebsd* | kfreebsd*-gnu)
+	  freebsd* | kfreebsd*-gnu | dragonfly*)
 	  	XORG_OS="freebsd"
 		XORG_OS_SUBDIR="bsd"
 		case $host_cpu in
