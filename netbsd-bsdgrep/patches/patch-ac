$NetBSD: patch-ac,v 1.2 2008/07/23 10:10:35 cheusov Exp $

--- grep.c.orig	2006-05-16 00:12:21.000000000 +0300
+++ grep.c
@@ -47,6 +47,13 @@ __RCSID("$NetBSD: grep.c,v 1.3 2006/05/1
 #include <string.h>
 #include <unistd.h>
 
+#if defined(HAVE_NBCOMPAT_H)
+#include <nbcompat/config.h>    /* needed for the other headers */
+#include <nbcompat/cdefs.h>     /* needed for the other headers */
+#include <nbcompat/stdio.h>
+#include <nbcompat/stdlib.h>
+#endif
+
 #include "grep.h"
 
 /* 
@@ -56,7 +63,7 @@ __RCSID("$NetBSD: grep.c,v 1.3 2006/05/1
 #define MAX_BUF_DIGITS	(sizeof(int) * 3) + 1
 
 /* Flags passed to regcomp() and regexec() */
-int cflags = REG_BASIC;
+int cflags = 0; /* REG_BASIC */
 int eflags = REG_STARTEND;
 
 int matchall;	/* shortcut */
@@ -71,7 +78,9 @@ char re_error[RE_ERROR_BUF + 1];
 int Aflag;		/* -A x: print x lines trailing each match */
 int Bflag;		/* -B x: print x lines leading each match */
 int Eflag;		/* -E: interpret pattern as extended regexp */
+#ifdef REG_NOSPEC
 int Fflag;		/* -F: interpret pattern as list of fixed strings */
+#endif
 int Gflag;		/* -G: interpret pattern as basic regexp */
 int Hflag;		/* -H: Always print filenames */
 int Lflag;		/* -L: only show names of files with no matches */
@@ -295,9 +304,11 @@ main(int argc, char *argv[])
 	case 'e':
 		Eflag++;
 		break;
+#ifdef REG_NOSPEC
 	case 'f':
 		Fflag++;
 		break;
+#endif
 	case 'g':
 		Gflag++;
 		break;
@@ -307,9 +318,11 @@ main(int argc, char *argv[])
 		case 'e':
 			Eflag++;
 			break;
+#ifdef REG_NOSPEC
 		case 'f':
 			Fflag++;
 			break;
+#endif
 		case 'g':
 			Gflag++;
 			break;
@@ -344,15 +357,23 @@ main(int argc, char *argv[])
 			break;
 			
 		case 'E':
-			Fflag = Gflag = 0;
+#ifdef REG_NOSPEC
+			Fflag = 0;
+#endif
+			Gflag = 0;
 			Eflag++;
 			break;
+#ifdef REG_NOSPEC
 		case 'F':
 			Eflag = Gflag = 0;
 			Fflag++;
 			break;
+#endif
 		case 'G':
-			Eflag = Fflag = 0;
+			Eflag = 0;
+#ifdef REG_NOSPEC
+			Fflag = 0;
+#endif
 			Gflag++;
 			break;
 		case 'H':
@@ -534,8 +555,10 @@ main(int argc, char *argv[])
 
 	if (Eflag)
 		cflags |= REG_EXTENDED;
+#ifdef REG_NOSPEC
 	else if (Fflag)
 		cflags |= REG_NOSPEC;
+#endif
 	r_pattern = grep_malloc(patterns * sizeof(*r_pattern));
 	for (i = 0; i < patterns; ++i) {
 		if ((c = regcomp(&r_pattern[i], pattern[i], cflags))) {
