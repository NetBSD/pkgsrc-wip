# $NetBSD: Makefile,v 1.3 2011/06/02 02:01:39 schnoebe Exp $

DISTNAME=		MostAwesomeDude-bravo-1.6.1-0-gad30cad
PKGNAME=		${PYPKGPREFIX}-bravo-1.6.1
CATEGORIES=		games
MASTER_SITES=		http://github.com/MostAwesomeDude/bravo/tarball/1.6.1/

MAINTAINER=		eric@cirr.com
HOMEPAGE=		http://www.bravoserver.org/
COMMENT=		Minecraft game server in python
LICENSE=		mit

# FETCH_USING=		wget
FETCH_USING=		curl

# make sure to update when updating DISTNAME.
#   thank you github for such amazing autogenerated names.
WRKSRC=			${WRKDIR}/MostAwesomeDude-bravo-f0974b6
EGG_NAME=		Bravo-1.6.1

DEPENDS+=		${PYPKGPREFIX}-construct>=0.4.1:../../wip/py-construct
DEPENDS+=		${PYPKGPREFIX}-numpy>=0nb4:../../math/py-numpy
DEPENDS+=		${PYPKGPREFIX}-twisted>=10.1:../../net/py-twisted

PYTHON_VERSIONS_ACCEPTED=	27 26

PKG_DESTDIR_SUPPORT=	user-destdir

# REPLACE_PYTHON+=	spectrumctl/spectrumctl.py
PY_PATCHPLIST=		yes
PYDISTUTILSPKG=		yes

.include "../../mk/bsd.prefs.mk"

BUILD_DEFS+=		VARBASE BRAVO_LOGDIR BRAVO_PIDDIR BRAVO_RUNDIR
BUILD_DEFS+=		BRAVO_USER BRAVO_GROUP

BRAVO_USER?=		bravo
BRAVO_GROUP?=		bravo
BRAVO_LOGDIR?=		${VARBASE}/log
BRAVO_PIDDIR?=		${VARBASE}/run
BRAVO_RUNDIR?=		${VARBASE}/tmp/bravo

PKG_GROUPS+=		${BRAVO_GROUP}
PKG_USERS+=		${BRAVO_USER}:${BRAVO_GROUP}

MESSAGE_SUBST+=		EGDIR=${EGDIR}
MESSAGE_SUBST+=		DOCDIR=${DOCDIR}
MESSAGE_SUBST+=		PKG_SYSCONFDIR=${PKG_SYSCONFDIR}

FILES_SUBST+=		PREFIX=${PREFIX}
FILES_SUBST+=		PYTHONBIN=${PYTHONBIN}
FILES_SUBST+=		BRAVO_USER=${BRAVO_USER}
FILES_SUBST+=		BRAVO_GROUP=${BRAVO_GROUP}
FILES_SUBST+=		BRAVO_LOGDIR=${BRAVO_LOGDIR}
FILES_SUBST+=		BRAVO_PIDDIR=${BRAVO_PIDDIR}
FILES_SUBST+=		BRAVO_RUNDIR=${BRAVO_RUNDIR}

RCD_SCRIPTS=		bravo
PKG_SYSCONFSUBDIR=	bravo
EGDIR=			${PREFIX}/share/examples/bravo
DOCDIR=			${PREFIX}/share/doc/bravo
CONF_FILES+=		${EGDIR}/bravo.ini ${PKG_SYSCONFDIR}/bravo.ini

DOCFILES=		administration.rst entity.rst noise.rst
DOCFILES+=		stdio.rst auxiliary.rst factory.rst
DOCFILES+=		packets.rst tools.rst blocks.rst features.rst
DOCFILES+=		philosophy.rst utilities.rst chunk.rst
DOCFILES+=		globals.txt plugin.rst web.rst conf.py
DOCFILES+=		ibravo.rst plugins.rst world.rst core.rst
DOCFILES+=		index.rst protocol.rst differences.rst
DOCFILES+=		location.rst simplex.rst


SUBST_CLASSES+=		cfgpath
SUBST_STAGE.cfgpath=	post-patch
SUBST_FILES.cfgpath+=	bravo/config.py
SUBST_FILES.cfgpath+=	docs/administration.rst
SUBST_MESSAGE.cfgpath=	Correcting the configuration directory.
SUBST_SED.cfgpath=	-e 's,@PKG_SYSCONFDIR@,${PKG_SYSCONFDIR},g'

INSTALLATION_DIRS=	bin ${PKG_SYSCONFDIR} ${EGDIR} ${DOCDIR}

post-install:
	${INSTALL_DATA_DIR} ${DESTDIR}${EGDIR}
	${INSTALL_DATA_DIR} ${DESTDIR}${DOCDIR}
	${INSTALL_DATA} ${WRKSRC}/bravo.ini.example \
						${DESTDIR}${EGDIR}/bravo.ini
.for f in ${DOCFILES}
	${INSTALL_DATA} ${WRKSRC}/docs/${f} ${DESTDIR}${DOCDIR}
.endfor


.include "../../lang/python/egg.mk"

.include "../../mk/bsd.pkg.mk"
