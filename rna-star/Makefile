# $NetBSD$
#
###########################################################
#                  Generated by fbsd2pkg                  #
#              Sun Jul 23 10:47:07 CDT 2023               #
###########################################################

###########################################################
# Unconverted and partially converted FreeBSD port syntax:

#NOT_FOR_ARCHS=		armv6 armv7 i386 mips powerpc powerpcspe
#NOT_FOR_ARCHS_REASON=	Requires 64-bit processor
#.if !exists(/usr/include/omp.h)
#BROKEN=		requires OpenMP support that is missing on this architecture
#.endif
# Unknown tool: USE_TOOLS=	compiler:c++11-lang
# Unknown tool: USE_TOOLS=	localbase:ldflags

DISTNAME=	STAR-2.7.10b
PKGNAME=	rna-STAR-2.7.10b
CATEGORIES=	biology
MASTER_SITES=	${MASTER_SITE_GITHUB:=alexdobin/}
GITHUB_PROJECT=	STAR

OWNER=		bacon@NetBSD.org
HOMEPAGE=	https://github.com/alexdobin/STAR
COMMENT=	Spliced Transcripts Alignment to a Reference
LICENSE=	gnu-gpl-v3

# Best guess translation of REINPLACE above.  Replace 1 with a
# meaningful name.  Assuming pre-configure: Change if necessary.
SUBST_CLASSES+=		htslib
SUBST_STAGE.htslib=	pre-configure
SUBST_SED.htslib+=	-e 's|"htslib/htslib/sam.h"|<htslib/sam.h>|g'
SUBST_SED.htslib+=	-e 's|"htslib/htslib/kstring.h"|<htslib/kstring.h>|g'
SUBST_SED.htslib+=	-e 's|"htslib/htslib/bgzf.h"|<htslib/bgzf.h>|g'
SUBST_FILES.htslib+=	BAMfunctions.cpp
SUBST_FILES.htslib+=	IncludeDefine.h
SUBST_FILES.htslib+=	STAR.cpp
SUBST_FILES.htslib+=	bamRemoveDuplicates.cpp
SUBST_FILES.htslib+=	bam_cat.c
SUBST_FILES.htslib+=	bam_cat.h
SUBST_FILES.htslib+=	signalFromBAM.h

# Test and change if necessary.
MAKE_JOBS_SAFE=	no

# Just assuming C and C++: Adjust this!
USE_LANGUAGES=	c c++
USE_TOOLS+=	gmake

WRKSRC=		${WRKDIR}/${DISTNAME}/source
MAKE_FLAGS=	HTSLIB=''

INSTALLATION_DIRS=	bin

do-install:
	${INSTALL_PROGRAM} ${WRKSRC}/STAR ${DESTDIR}${PREFIX}/bin

.include "../../mk/bsd.prefs.mk"

# Xcode supports -Xpreprocessor -fopenmp, but does not supply OpenMP libs
# parallel/openmp installs an entire llvm
# Maybe a libomp package would suffice?
.if ${OPSYS} == Darwin
SUBST_CLASSES+=		openmp
SUBST_SED.openmp=	-e 's|-fopenmp|-Xpreprocessor &|g'
SUBST_STAGE.openmp=	pre-configure
SUBST_FILES.openmp=	Makefile
LDFLAGS  += -L${PREFIX}/lib -lomp -pthread -lm
.include "../../parallel/openmp/buildlink3.mk"
.endif

# Convert any _DEPENDS above that have a buildlink3.mk
.include "../../biology/htslib/buildlink3.mk"
# CentOS doesn't have zlib in the base, so uncomment if needed.
# .include "../../devel/zlib/buildlink3.mk"
.include "../../mk/bsd.pkg.mk"
