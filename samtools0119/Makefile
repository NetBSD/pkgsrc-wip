# $NetBSD$

###########################################################
#               Generated by fbsd2pkg                     #
###########################################################

DISTNAME=	samtools-${PORTVERSION}
PKGNAME=	samtools0119-${PORTVERSION}
CATEGORIES=	biology
MASTER_SITES=	${MASTER_SITE_SOURCEFORGE:=samtools/}
EXTRACT_SUFX=	.tar.bz2

MAINTAINER=	bacon@NetBSD.org

PORTVERSION=	0.1.19

COMMENT=	Generic format for storing large nucleotide sequence alignments
# LICENSE=	

USE_TOOLS+=	gmake perl
USE_ZLIB=	yes

REPLACE_PERL=	misc/export2sam.pl misc/plot-bamcheck
REPLACE_PYTHON=	misc/varfilter.py

# No REPLACE_LUAJIT available at this time
SUBST_CLASSES+=		luajit
SUBST_STAGE.luajit=	post-patch
SUBST_SED.luajit=	-e 's|/usr/bin/env luajit|${PREFIX}/bin/luajit|g'
SUBST_FILES.luajit=	misc/r2plot.lua misc/vcfutils.lua

LDFLAGS+=	${COMPILER_RPATH_FLAG}${PREFIX}/lib

SAMPREFIX=	${PREFIX}/samtools0119

do-build:
	cd ${WRKSRC} && ${MAKE_PROGRAM} LDFLAGS="${LDFLAGS}" all-recur razip

do-install:
	${MKDIR} ${DESTDIR}${SAMPREFIX}/bin
	${INSTALL_PROGRAM} ${WRKSRC}/samtools ${DESTDIR}${SAMPREFIX}/bin
	${INSTALL_PROGRAM} ${WRKSRC}/razip ${DESTDIR}${SAMPREFIX}/bin
	${INSTALL_PROGRAM} ${WRKSRC}/bcftools/bcftools ${DESTDIR}${SAMPREFIX}/bin
.for f in ace2sam bamcheck maq2sam-long maq2sam-short md5fa md5sum-lite wgsim
	${INSTALL_PROGRAM} ${WRKSRC}/misc/${f} ${DESTDIR}${SAMPREFIX}/bin
.endfor
	${INSTALL_SCRIPT} ${WRKSRC}/misc/*.pl ${WRKSRC}/misc/plot-bamcheck \
		${DESTDIR}${SAMPREFIX}/bin
	${INSTALL_SCRIPT} ${WRKSRC}/misc/*.py ${DESTDIR}${SAMPREFIX}/bin
	${INSTALL_SCRIPT} ${WRKSRC}/misc/*.lua ${DESTDIR}${SAMPREFIX}/bin
	${MKDIR} ${DESTDIR}${SAMPREFIX}/lib
	${INSTALL_DATA} ${WRKSRC}/libbam.a ${DESTDIR}${SAMPREFIX}/lib
	${MKDIR} ${DESTDIR}${SAMPREFIX}/man/man1
	${INSTALL_MAN} ${WRKSRC}/samtools.1 ${DESTDIR}${SAMPREFIX}/man/man1
	${MKDIR} ${DESTDIR}${SAMPREFIX}/include/bam
	${INSTALL_DATA} ${WRKSRC}/*.h ${DESTDIR}${SAMPREFIX}/include/bam

.include "../../lang/python/application.mk"
.include "../../lang/lua/application.mk"
.include "../../lang/LuaJIT2/buildlink3.mk"
.include "../../devel/zlib/buildlink3.mk"
.include "../../devel/ncurses/buildlink3.mk"
.include "../../mk/bsd.pkg.mk"
