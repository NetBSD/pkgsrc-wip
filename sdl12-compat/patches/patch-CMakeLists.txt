$NetBSD$

# Fix install_name on macOS

--- CMakeLists.txt.orig	2022-03-03 14:56:56.000000000 +0000
+++ CMakeLists.txt
@@ -24,10 +24,6 @@ if(APPLE)
   set(DYLIB_COMPAT_VERSION 1.0.0 CACHE STRING "library compatibility version")
   set(DYLIB_CURRENT_VERSION 12.52.0 CACHE STRING "library current version")
   include_directories("/opt/X11/include")  # hack.
-  if(CMAKE_VERSION VERSION_LESS 3.9)
-  else()
-    cmake_policy(SET CMP0068 NEW)  # on macOS, don't let RPATH affect install_name.
-  endif()
 endif()
 
 if(WIN32)
@@ -71,7 +67,7 @@ string(STRIP "${CMAKE_C_FLAGS}" CMAKE_C_
 
 if(UNIX AND NOT APPLE)
     set_target_properties(SDL PROPERTIES COMPILE_DEFINITIONS "_REENTRANT")
-    target_link_libraries(SDL PRIVATE dl)
+    target_link_libraries(SDL PRIVATE ${CMAKE_DL_LIBS})
 endif()
 if(APPLE)
     set_target_properties(SDL PROPERTIES INSTALL_NAME_DIR "")
@@ -254,7 +250,7 @@ if(SDL12DEVEL)
       set(SDL_CFLAGS "-D_GNU_SOURCE=1 -D_REENTRANT")
       set(SDL_RLD_FLAGS "")  # !!! FIXME: this forces rpath, which we might want?
       set(SDL_LIBS "-lSDL")
-      set(SDL_STATIC_LIBS "-ldl")
+      set(SDL_STATIC_LIBS ${CMAKE_DL_LIBS})
       if(NOT STATICDEVEL)
         set(SDL_STATIC_LIBS "")
       endif()
@@ -297,7 +293,7 @@ if(STATICDEVEL AND SDL12DEVEL)
   add_library(SDL-static STATIC ${SDL12COMPAT_SRCS})
   target_include_directories(SDL-static PRIVATE ${SDL2_INCLUDE_DIRS})
   set_target_properties(SDL-static PROPERTIES COMPILE_DEFINITIONS "_REENTRANT")
-  target_link_libraries(SDL-static PRIVATE dl)
+  target_link_libraries(SDL-static PRIVATE ${CMAKE_DL_LIBS})
   set_target_properties(SDL-static PROPERTIES
           VERSION "${PROJECT_VERSION}"
         OUTPUT_NAME "SDL")
